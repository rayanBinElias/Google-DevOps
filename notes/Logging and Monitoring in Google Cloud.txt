Module 1:Introduction to Google CLoud's Operations Suite
  - In this module, we will take some time to do a high-level overview of the various products which comprise Google Cloud’s logging, 
  monitoring, and observability suite.

  Learning Objectives
    1. Describe the purpose and capabilities of Google Cloud’s operations suite
    2. Explain the purpose of the Cloud Monitoring tool.
    3. Explain the purpose of Cloud Logging and Error Reporting tools.
    4. Explain the purpose of Application Performance Management tools.
    5. Explain the purpose of Cloud Trace

  Need for google Cloud observability
    1. Visibility into system health
      - help me understand my app and tell if it's healthy

    2. Error reporting and alerting
      - bring problems directly to my attention

    3. Efficient troubleshooting
      - help me fix it if it's broken

    4. Performance improvement

    Monitoring
      - gives you real-time sys information
      - collecting, processing, aggregating and displaying real-time quanitative data about a sys such as:
        - query counts and types
        - error counts and types
        - processing times
        - server lifetimes
      - foundation of product reliability

    What's needed from products?
      1. Continual improvement
      2. Dashboards
      3. Automated alerts
      4. Incident response

    Four golden signals
      1. latency
        - changes in latency could indicate emerging issues
        - its values may be tied to capacity demands
        - it can be used to measure sys improvements

        How?
          - page load latency
          - number of req waiting for a thread
          - service response time
          - transaction duration
          - time to first response 
          - and time to complete data return.

      2. Traffic
        - indicator of current sys demands
        - historical trends are used for capacity planning
        - core measure when calculating infra spend

        How?
          -  number of HTTP requests per second
          - number of requests for static vs. dynamic content
          - number of concurrent sessions

      3. Saturation
        - indicator of how full the service is
        - focuses on the most constrained resources
        - freqntly tied to degrading performance as capacity is reached
        
        How?
          - percentage memory utilization
          - percentage of thread pool utilization
          - percentage of cache utilization

      4. errors
        - indicate configuration or capacity issues
        - indicate service level objective violations
        - error might mean it's time to send out an alert

        How?
         - number of 400/500 HTTP codes
         - number of failed requests
         - number of exceptions 

    Observability steps
      1. Capture signals
        - metrics
        - Logs
        - Trace
      
      1.1 Manage Incidents
        - alerts
        - error reporting
        - SLO
      
      2. Visualze and Analyze
        - Dashboards
        - metrics Explorer
        - logs Explorer
        - service monitoring
        - log analytics
        - health checks

      3. Troubleshoot
    
  Cloud Monitoring
    - rovides visibility into the performance, uptime, and overall health of cloud-powered applications. 
    - It collects metrics, events, and metadata from projects, logs, services, systems, agents, custom code, and various common application components, including 
      - Cassandra
      - Nginx
      - Apache Web Server
      - Elasticsearch
    - Monitoring ingests that data and generates insights via dashboards, Metrics Explorer charts, and automated alerts

    Feautures
      - Many free metrics
      - Open source standards
      - customization for key workloads
      - in-context visualizations & alerts

  Cloud  Logging
    - allows users to collect, store, search, analyze, monitor, and alert on log entries and events. 
    - It provides automatic ingestion with simple controls for routing, storing, and displaying your log data. 
    - It leverages tools like Log Analytics to view trends, or Error Reporting and Log Explorer to quickly examine problems

    Multiple aspects
      - collect
        - cloud events
        - config changes
        - customer services
        - logs at various level of the resource hierarchy
     
     - analyze
        - log data in real time w/ integrated logs Explorer
        - run queries and analyze w/ log analytics
        - exported logs from 
          - GCS
          - bigquery
      
      - export
        - export to 
          - GCS
          - bigquery
          - pub/sub messages
            - can be anlayzed in near-real time using custom code or stream processing like dataflow
        - log-based metrics fro augemented monitoring

      - retain
        - data access and service logs for 30 days (configurble upto 3650 days)
        - admin logs for 400 days by default
        - longer term in GCS/bq

    Use case
      1. Developers
        - troubleshooting
        - debugging
       
        - Integration into popular SDKs
          - get started quickly w/ a large collection of sys metrics and logs
        
        - real time log analysis
          - analyze log data in real time, devug code, troubleshoot your apps
        
        - quick error detection
          - find errors via stack traces automatically w/ error reporting

      2. Operator
        - SLO/alerting
        - log Management
        - workload Management
        - cost Management
        
        - Collect the right telemetry
          - instrumentation for GCE, on-prem and other cloud providers

        - Centralize logs
          - centralize logs for specific users, teams and/or org

        - Manage logs
          - set retention periods, select supported regions for regional data storage

        - Set alerts
          - understand log volume/cost, set alerts on important app metrics

        - Export logs
          - export to Google CLoud for storage, analysis and integration w/ 3rd parties

      3. SecOps Analyst
        - Secops of google cloud fleet of resources
        - uses platform features to meet org sec requirements

        - collect auidt logs
          - collect google cloud audit logs by default, advanced sec logs such as data access logs

        - collect network telemetry data
          - collect and analyze VPC flow logs, GKE network, firewall, load balancer logs

        - analyze logs for security events
          - view audit logs and other events to investigate possible sec events

  Error Reporting
    - identifies, counts, analyzes and aggregates the crashes in your running cloud services

    features
      - real-time processing
        - app arrors are processed and displayed w/in seconds

      - quickly view and understand errors
        - dedicated page displays the details of the error

      - instant notification
        - notified when events occur

      - dedicated view
        - time charts
        - occurences
        - affected user counts
        - first and last seen dates
        - cleaned exception stack trace

      - alerting policy

  Application Performance Management Tools
    1. Cloud Trace
      - collects latency data from distributed app and displays it in the GC console
      - captures traces from app deployed
        - App engine flexible and standard env
        - GCE VMs
        - GKE containers
        - Cloud run
        - non GC env

      Latency Reports
        - provide performance insights in near-real time
        - generate in-depth latency reports to surface performance degradations
        - identify recent changes to app performance

    2. Cloud Profiler
      - uses statistical tech and extremely low-impact instrumentation to provide complete picture of app
      - allows dev to analyze app running anywhere
      - presents call hierarchy and resource consumption of relevant function in an interactive flame graph

  Google Cloud's Operation suite
    - helps you explore the known and unknown issues
    
    - user-focused products
      - SLO monitoring, uptime checks, tracing

    - open,flexible foundations
      - prometheus
      - opentelemetry
      - fluentbit

    - integrated for ease
      - auto 
        -ingest log
        - connect sets
        - collect in-context telemetry across GC services

    - meaningful analysis and alerting
      - use powerful analysis tools
      - leverage alerting for both automated and human-led resolutions

  Quiz
    1. You want a simple way to see the latency of requests for a web application you deployed to Cloud Run. What Google Cloud tool should you use?
      - Trace

    2. You want to examine messages generated by running code. Which tool might be best for doing this?
      - Logs Explorer

    3. Users have reported that an application occasionally returns garbage data instead of the intended results, but you have been unable to reproduce this problem in your test environment. Which tool might be of best help?
      - Error Reporting
      
      - Logs Explorer

    4. You want to calculate the uptime of a service and receive alerts if the uptime value falls below a certain threshold. Which tool will help you with this requirement?
      - Cloud Monitoring

      - Profiler

Module 2: Monitoring Critical systems
  - Monitoring is all about keeping track of exactly what's happening with the resources we've spun up inside of Google's Cloud. 
  In this module, we'll take a look at options and best practices as they relate to monitoring project architectures. We'll...

  Learning Objectives
    1. Use Cloud Monitoring to view metrics for multiple cloud projects.
    2. Explain the different types of dashboards and charts that can be built.
    3. Create an uptime check.
    4. Explain the cloud operations architecture.
    5. Explain and demonstrate the purpose of using Monitoring Query Language (MQL) for monitoring.

  Cloud Monitoring architecture patterns
    Three layers
      1. Data collection layers
        - collects  
          - metrics
          - logs
          - traces
      
      2. Data storage layer
        - stores the collected data
        - routes to the configured visualization and analysis layer
        - includes the cloud monitoring API
          - helps triage the metrics collected to be stored for future analysis
      
      3. data analysis and visualization layer
        - analyzes the collected data to identify
          - problems
          - trends 
          - presents the analyzed data in a way that is easy to understand
          - dashboards
            - visualize data
          - uptime checks
            - monitor app
          - alerting policies
            - config alerts
            - notify events or email

        Notes
          Platform monitoring/Cloud Monitoring
            - no copst for all system metrics

          Application monitoring - GKE
            - integrates w/:
              - cloud logging
              - cloud monitoring
              - google cloud managed service for prometheus
                - collects data

              Google Managed Prometheus(GMP)
                - part of cloud monitoring as aprometheus data
                - promql compatible query language

          Application monitoring - GCE
            - ops agents to collect data
            - partner with 
              - Datadog/NewRelic
              - BindPlane by Blue Medora for logs collection
  
  Monitoring multiple projects
    - only one single project in metric scope by default

    Scoping project
      - hosts a metrics scope
      - stores
        - alerts
        - uptime checks
        - dashboards
        - monitoring groups

    Notes
      - Production deployment
        - create a separate projects for monitoring

        Why?
          - single pane of glass that provides visibility into the enire group of related projects
            - monitoring config for other project is retain if fe/be/db are deleted

      monitoring.viewer
        - access to dashboards and access to all data by default
          - including all other projects that are monitored by that metrics scope

  Data model and dashboards
    Data model
      time-series data
        - metric
          - metric label
          - metric type
          - desicribes the metric
        - resource
          - resopurce-label
          - resource info
        - metricKind and valueType
          - how to interpret the values
        - points
          - values of the metrics

  Query metrics 
    - using MQL and promql

    MQL
      - query cloud monitoring time-series data by using text-based interface
      - manipulate, retrieve and perform complex operations on time-series data
    
    PromQL
      - query metrics from Google Cloud Managed Service for Prometheus
      - Query system metrics from GKE and Compute engine
      -Integra

  Uptime checks
    - test availability of your public services from locations around the world
    - can help us ensure that external facing services are running 
    and we aren't burning our error budgets
    - can be set to
      - HTTP
      - https
      - TCP
    - can check 
      - app engine app
      - GCE instance
      - URL of a host
      - AWS instance
      - load balancer
    - can create alerting policy and budget alert

Budgets & alerts
  - Select a billing account to go to the budgets & alerts page, 
  where you can create budgets to monitor all of your Google Cloud charges in one place.
    
  Qwiklabs: Monitoring and Dashboarding Multiple Projects from a Single Workspace
    - Google Cloud Monitoring empowers users with the ability to monitor multiple projects from a single metrics scope.
    In this exercise, you start with three Google Cloud projects, two with monitorable resources, and the third you use to host a metrics scope.
    You attach the two resource projects to the metrics scope, build uptime checks, and construct a centralized dashboard.

    - Monitoring and Dashboarding Multiple Projects
    - https://www.coursera.org/learn/logging-monitoring-observability-google-cloud/gradedLti/yxggp/lab-monitoring-and-dashboarding-multiple-projects-from-a-single-workspace

    Objectives
      - Configure a Worker project.
      - Create a metrics scope and link the two worker projects into it.
      - Create and configure Monitoring Groups.
      - Create and test an uptime check.

    Task 1: Configure the resource projects
      Install Nginx
        sudo apt-get update

        sudo apt-get install -y nginx

        ps auwx | grep nginx
        

    Task 2: Create a metrics scope and link the two worker projects into it
      ADD GCP PROJECTS.

Click Select Project and select the Worker 1 and Worker 2 projects.

    Task 3: Create and configure Monitoring groups

    Task 4: Create and test an uptime check

    Task 5: Create a custom dashboard
      sudo apt-get update
      sudo apt-get install apache2-utils

      curl 100,000
        ab -s 120 -n 100000 -c 100 $URL/

      curl 500,000
        ab -s 120 -n 500000 -c 500 $URL/
    
  Summary
    1. use cloud monitoring to view metrics for multiple cloud projects

    2. explain the different types of dashboards and charts that can be built

    3. create an uptime check

    4. explain the purpose of using MQL for monitoring

  Quiz
    1. You want to analyze the error rate in your load balancing environment. Which interface helps you view a chart with a ratio of 500 responses to all responses
      - MQL

      - Metrics Explorer

    2. You want to be notified if your application is down. What Google Cloud tool makes this easy?
      - Uptime check

    3. What is the name of the project that hosts a metrics scope?
      - Scoping project

      - Hosting project

Module 3: Alerting policies
  - Alerting gives timely awareness to problems in your cloud applications so you can resolve the problems quickly. 
  In this module, you will learn how to develop alerting strategies, define alerting policies, add notification channels, identify types of...

  Learning Objectives
    - Explain alerting strategies.
    - Explain alerting policies.
    - Explain error budget.
    - Explain why server-level indicators (SLIs), service-level objectives (SLOs), and service-level agreements (SLAs) are important.
    - Identify types of alerts and common uses for each.
    - Use Cloud Monitoring to manage services.

  SLI, SLO and SLAs
    SLIs
      - must be a number or a delta, something we can measure and place in a mathematical equation
        - Error rate

    SLOs
      - 99.5 or 99.9%

      Criteria
        - S: specific
        - M: measurable
        - A: achievable
        - R: relevant
        - T: time-bound

    SLAs
      - commitments made to your customers
        - that sys and app will have only a certain amt of downtime

    Deciding SLA, SLO and SLI
      Indicators
        http get / latency

      Objectives
        200ms

      Agreement 
        300ms

  Developing an alerting strategy

  Creating alerts

  Qwiklab: Alerting in Google Cloud
    - In this lab, you deploy an application to App Engine 
    and then create alerting policies to notify you 
    if the application is not accessible or is generating errors.

    - https://googlecoursera.qwiklabs.com/focuses/35934121?parent=lti_session

    Objectives
      In this lab, you learn how to perform the following tasks:

      - Download a sample app from GitHub.
      - Deploy an application to App Engine.
      - Create uptime checks and alerts.
      - Optionally, create an alerting policy with the CLI.

    Task 1 Download and test a sample app from GitHub
      //create app engine region
      gcloud app create --region=us-east4

      // deploy in app engine
      gcloud app deploy --version=one --quiet
   
    Task 2: Deplpy an app to app engine
    
    Task 3. Examine the App Engine logs  

    Task 4. Create an App Engine latency alert
      //redeploy new version GAE
      gcloud app deploy --version=two --quiet

      //generate some consistent load, in Cloud Shell, enter the following command:
      while true; do curl -s https://$DEVSHELL_PROJECT_ID.appspot.com/ | grep -e "<title>" -e "error";sleep .$[( $RANDOM % 10 )]s;done

      - This command makes requests to the App Engine app continuously in a loop. The grep command will display the title of the page when the request works. It also displays the error, if it doesn’t work. Every iteration, the thread sleeps a random amount of time less than a second, but with the 10s response time delay it will seem much longer.

    Task 5. (Optional) Creating an Alerting Policy with the CLI
      //app-engine-error-percent-policy.json.
        https://googlecoursera.qwiklabs.com/focuses/35934121?parent=lti_session

      //Deploy alerting policy w/ gcloud
        gcloud alpha monitoring policies create --policy-from-file="app-engine-error-percent-policy.json"
 
  Service Monitoring

  Qwiklab: Service Monitoring
    - Google Cloud's Service Monitoring streamlines the creation of microservice Service Level Objectives (SLOs) 
    based on availability, latency, or custom Service Level Indicators (SLIs). 
    In this lab, you use Service Monitoring to create a 99.5% availability SLO 
    and corresponding alert.

    Objectives
      - In this lab, you learn how to perform the following tasks:

      - Deploy a test application.
      - Use Service Monitoring to create an SLO.
      - Tie an alert to the SLO.

    Task 1. Deploy a test application

    Task 2. Use Service Monitoring to create an availability SLO
      In this task, you:
        - Use Service Monitoring to create an availability SLO.
        - Create an alert tied to your SLO.
        - Trigger the alert.


  Quiz
    1. In evaluating your alerting policies, which below best describes precision? 
      - The proportion of events detected that were significant.

    2. Explain error budget.
      - The proportion of alerts detected that were relevant to the sum of relevant alerts and missed alerts.

      - How long alerts fire after an issue is resolved.

    3. In the statement “Maintain an error rate of less than 0.3% for the billing system”, what is an SLI?
      - Error rate
      
      - 0.3%

      - Less than 0.3%

Module 4: Advanaced logging and analysis
  - In this module, we will examine some of Google Cloud's advanced logging and analysis capabilities.
  Specifically, in this module you will learn to identify and choose among resource tagging approaches, define log sinks, create monitoring metrics...

  Learning Objectives
    - Use Log Explorer features.
    - Explain the features and benefits of logs-based metrics.
    - Define log sinks (inclusion filters) and exclusion filters.
    - Explain how BigQuery can be used to analyze logs.
    - Export logs to BigQuery for analysis.
    - Use log analytics on Google Cloud.

  Cloud Logging overview and architecture

  Log types and collection

  Storing, routing and exporting the logs

  Query and view logs

  Using log-based metrics

  Log analytics

  Qwiklab: Log analytics

  Quiz
    1. You want to compare resource utilization for VMs used for production, development, and testing. What should you do?
      - Add a label called “state” to your VMs with the values “dev”, “test”, and “prod” and group by that label in your monitoring chart.

    2. Your manager wants a daily report of resource utilization by application. Where would the best export sink be?
      - GCS

      - pub/sub
      - bq





